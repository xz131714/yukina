---
import Main from "../layouts/MainLayout.astro";
import Markdown from "../components/Markdown.astro";
import CopyRight from "../components/misc/CopyRight.astro";
import Giscus from "../components/Giscus.astro";
import { Icon } from "astro-icon/components";

interface Props {
  title?: string;
  subTitle?: string;
  bannerImage?: string;
  published?: Date;
  license?: {
    name: string;
    url?: string;
  };
  author?: string;
  sourceLink?: string;
  prevPost?: { slug: string; title: string } | null;
  nextPost?: { slug: string; title: string } | null;
}

const {
  title,
  subTitle,
  bannerImage,
  published,
  license,
  author,
  sourceLink,
  prevPost,
  nextPost,
} = Astro.props;
---

<Main title={title} subTitle={subTitle} bannerImage={bannerImage}>
  <!-- <Fragment set:html={tocHTMLString} /> -->
  <div class="article-wrapper">
    <div class="article">
      <Markdown>
        <slot />
      </Markdown>
      {
        published && title && (
          <CopyRight
            title={title}
            published={published}
            license={license}
            author={author}
            sourceLink={sourceLink}
          />
        )
      }
    </div>
  </div>
  
  <!-- 文章上下篇导航 -->
  {(prevPost || nextPost) && (
    <div class="post-navigation flex flex-col md:flex-row justify-between mt-6 mb-6 gap-4">
      {prevPost && (
        <a href={`/blog/${prevPost.slug}`} class="prev-post flex-1">
          <div class="theme-card rounded-2xl w-full h-[3.75rem] px-4 flex items-center justify-start gap-3">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="text-[1.5rem] text-white">
              <path fill="currentColor" d="M15.41 16.58L10.83 12l4.58-4.59L14 6l-6 6l6 6l1.41-1.42Z"/>
            </svg>
            <div class="overflow-hidden overflow-ellipsis whitespace-nowrap text-white font-medium">
              {prevPost.title}
            </div>
          </div>
        </a>
      )}
      
      {nextPost && (
        <a href={`/blog/${nextPost.slug}`} class="next-post flex-1">
          <div class="theme-card rounded-2xl w-full h-[3.75rem] px-4 flex items-center justify-end gap-3">
            <div class="overflow-hidden overflow-ellipsis whitespace-nowrap text-white font-medium">
              {nextPost.title}
            </div>
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="text-[1.5rem] text-white">
              <path fill="currentColor" d="M8.59 16.58L13.17 12L8.59 7.41L10 6l6 6l-6 6l-1.41-1.42Z"/>
            </svg>
          </div>
        </a>
      )}
    </div>
  )}

  <!-- 评论区 -->
  <div class="comments-wrapper mt-6 mx-3 rounded-2xl bg-[var(--card-color)] px-5 py-6 lg:mx-0 lg:px-10 lg:py-9">
    <h2 class="text-2xl font-bold mb-4 text-[var(--text-color)]">评论</h2>
    <Giscus />
  </div>
</Main>

<style>
  .article-wrapper {
    @apply mx-3 rounded-2xl bg-[var(--card-color)] px-5 py-6 lg:mx-0 lg:px-10 lg:py-9;
  }
  .article {
    @apply flex flex-col;
    font-size: var(--primary-font);
  }
  
  .btn-card {
    @apply transition-all bg-[var(--card-color-light)] hover:bg-[var(--card-color-hover)] active:scale-95;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
  }
  
  .theme-card {
    @apply transition-all active:scale-95;
    background-color: var(--primary-color);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }
  
  :root.dark .theme-card {
    filter: brightness(0.85);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
  }
  
  .theme-card:hover {
    @apply brightness-110;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
  }
  
  :root.dark .theme-card:hover {
    filter: brightness(0.95);
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
  }
  
  .post-navigation a {
    @apply transition-all;
  }

  .comments-wrapper h2 {
    position: relative;
    padding-left: 1rem;
  }

  .comments-wrapper h2::before {
    content: "";
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 4px;
    height: 1.25rem;
    background-color: var(--primary-color);
    border-radius: 2px;
  }
</style>
